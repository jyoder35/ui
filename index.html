<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AZM – Workspace 4 • Lead‑Gated Mortgage Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>Mortgage Calculator (Lead‑Gated)</h1>
    <div class="timestamp" id="lastQuoted">Last quoted: —</div>
  </header>

  <main class="container">

    <!-- ---------- DEV CONFIG (appears only in dev mode) ---------- -->
    <section class="card" id="devConfig" style="display:none">
      <h2>Developer Config</h2>
      <div class="grid grid-2">
        <div class="form-control">
          <label for="ws3BaseInput">WS‑3 Base URL</label>
          <input id="ws3BaseInput" type="text" placeholder="https://.../exec" />
          <div class="helper">Overrides baked‑in WS‑3 for upsertLead + saveQuote.</div>
        </div>

        <div class="form-control">
          <label>Dev mode</label>
          <div class="pill-group" id="devModeGroup">
            <button class="pill" data-value="on">On</button>
            <button class="pill active" data-value="off">Off</button>
          </div>
        </div>
      </div>

      <div class="form-control">
        <label for="tablesJson">State Tables JSON</label>
        <textarea id="tablesJson" rows="10" placeholder='Paste either:
{
  "STATE_TAX_RATE_2023_PCT": { "AZ":0.5, ... },
  "HOI_2022": { "Arizona":1018, ... }
}
or just one of those objects.'></textarea>
        <div class="helper">
          HOI is the avg annual premium for $300k coverage (2022), scaled by value.  
          Taxes = value × state % (2023).
        </div>
      </div>

      <div class="actions">
        <button id="applyConfigBtn" class="primary">Apply & Save</button>
        <button id="resetConfigBtn" class="ghost">Reset Overrides</button>
      </div>
      <div class="status-line" id="devStatus"></div>
    </section>

    <!-- ------------------ PROGRAM / TXN / TERM / ZIP ------------------- -->
    <section class="card">
      <h2>Program / Transaction / Term / ZIP</h2>

      <div class="grid grid-4">
        <div class="form-control">
          <label>Program</label>
          <select id="program">
            <option value="CONV30">Conventional 30</option>
            <option value="CONV15">Conventional 15</option>
            <option value="FHA30">FHA 30</option>
            <option value="VA30">VA 30</option>
            <option value="DSCR30">DSCR 30</option>
          </select>
        </div>

        <div class="form-control">
          <label>Transaction</label>
          <div class="pill-group" id="txnGroup">
            <button class="pill active" data-value="PURCHASE">Purchase</button>
            <button class="pill" data-value="REFI">Refi</button>
          </div>
        </div>

        <div class="form-control">
          <label>Term</label>
          <div class="pill-group" id="termGroup">
            <button class="pill active" data-value="360">30‑yr</button>
            <button class="pill" data-value="180">15‑yr</button>
          </div>
        </div>

        <div class="form-control">
          <label>Property ZIP</label>
          <div class="zip-row">
            <input id="propZip" maxlength="5" value="85254" class="needs-update" />
            <div id="cityState" class="city-state">—</div>
          </div>
          <div id="zipMsg" class="msg" style="display:none"></div>
          <div class="helper">Change ZIP to a new valid 5‑digit value to enable results.</div>
        </div>
      </div>

      <div class="actions">
        <button id="gateBtn" class="primary" disabled>Get My Results</button>
      </div>
      <div id="statusTop" class="status-line"></div>
    </section>

    <!-- ------------------- LOAN STRUCTURE --------------------- -->
    <section class="card">
      <h2>Loan Structure</h2>

      <div class="grid grid-3">
        <div class="form-control">
          <label>Property Value</label>
          <input id="propValue" value="$500,000" />
        </div>

        <div class="form-control">
          <label>LTV %</label>
          <input id="ltvPct" value="80%" />
        </div>

        <div class="form-control">
          <label>Loan Amount</label>
          <input id="loanAmt" value="$400,000" />
        </div>
      </div>
    </section>

    <!-- ------------------- CREDIT & POINTS --------------------- -->
    <section class="card">
      <h2>Credit & Points</h2>

      <div class="grid grid-2">
        <div class="form-control">
          <label>FICO</label>
          <div class="range-row">
            <input id="fico" type="range" min="580" max="820" step="10" value="740" />
            <input id="ficoNum" type="number" value="740" class="chip" />
          </div>
        </div>

        <div class="form-control">
          <label>Borrower Points</label>
          <div class="range-row">
            <input id="points" type="range" min="-3" max="3" step="0.125" value="0" />
            <input id="pointsNum" type="number" value="0" class="chip" />
          </div>
        </div>
      </div>

      <div class="grid grid-3">
        <div class="form-control">
          <label>PMI</label>
          <div class="pill-group" id="pmiToggle">
            <button class="pill active" data-value="true">Yes</button>
            <button class="pill" data-value="false">No</button>
          </div>
        </div>

        <div class="form-control">
          <label>DTI &gt; 45%</label>
          <div class="pill-group" id="dti45">
            <button class="pill" data-value="true">Yes</button>
            <button class="pill active" data-value="false">No</button>
          </div>
        </div>

        <div class="form-control">
          <label>2+ Borrowers</label>
          <div class="pill-group" id="twoBorrowers">
            <button class="pill" data-value="true">Yes</button>
            <button class="pill active" data-value="false">No</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ---------------- TAXES & INSURANCE ------------------ -->
    <section class="card">
      <h2>Taxes & Insurance</h2>

      <div class="grid grid-3">
        <div class="form-control">
          <label>Annual Taxes (Est.)</label>
          <div class="with-chip">
            <input id="taxes" value="$0" />
            <button id="taxAutoChip" class="mini-chip active">Auto</button>
          </div>
        </div>

        <div class="form-control">
          <label>Annual HOI (Est.)</label>
          <div class="with-chip">
            <input id="ins" value="$0" />
            <button id="insAutoChip" class="mini-chip active">Auto</button>
          </div>
        </div>

        <div class="form-control">
          <label>Annual HOA</label>
          <input id="hoa" value="$0" />
        </div>
      </div>

      <div class="helper">Auto‑estimated using state tax % and HOI premiums; editable.</div>
    </section>

    <!-- -------- FHA Panel -------- -->
    <section class="card" id="panelFHA" hidden>
      <h2>FHA Options</h2>
      <div class="grid grid-2">
        <div class="form-control">
          <label>Finance UFMIP</label>
          <div class="pill-group" id="financeUfmip">
            <button class="pill active" data-value="true">Yes</button>
            <button class="pill" data-value="false">No</button>
          </div>
        </div>

        <div class="form-control">
          <label>Annual MIP %</label>
          <input id="annualMip" type="number" step="0.01" value="0.55" />
        </div>
      </div>
    </section>

    <!-- -------- VA Panel -------- -->
    <section class="card" id="panelVA" hidden>
      <h2>VA Options</h2>
      <div class="grid grid-2">
        <div class="form-control">
          <label>Funding Fee Exempt</label>
          <div class="pill-group" id="vaExempt">
            <button class="pill" data-value="true">Yes</button>
            <button class="pill active" data-value="false">No</button>
          </div>
        </div>

        <div class="form-control">
          <label>First Use</label>
          <div class="pill-group" id="vaFirstUse">
            <button class="pill active" data-value="true">Yes</button>
            <button class="pill" data-value="false">No</button>
          </div>
        </div>
      </div>
    </section>

    <!-- -------- DSCR Panel -------- -->
    <section class="card" id="panelDSCR" hidden>
      <h2>DSCR Options</h2>
      <div class="form-control">
        <label>DSCR Ratio</label>
        <input id="dscrRatio" type="number" step="0.05" value="1.25" />
      </div>
    </section>

    <!-- ---------------- RESULTS ------------------ -->
    <section class="card">
      <h2>Results</h2>

      <div id="results" class="results">
        <div class="muted">Results will appear here after pricing.</div>
      </div>

      <div class="actions">
        <button id="saveQuoteBtn" class="secondary" disabled>Save Quote</button>
      </div>

      <div id="statusBottom" class="status-line"></div>
    </section>

  </main>

  <!-- ---------------- LEAD MODAL ---------------- -->
  <div id="leadModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-card">
      <h3>Get My Results</h3>

      <form id="leadForm">
        <div class="grid grid-2">
          <div class="form-control">
            <label>First Name</label>
            <input id="firstName" required />
          </div>
          <div class="form-control">
            <label>Last Name</label>
            <input id="lastName" required />
          </div>
        </div>

        <div class="grid grid-2">
          <div class="form-control">
            <label>Phone</label>
            <input id="phone" />
          </div>
          <div class="form-control">
            <label>Email</label>
            <input id="email" type="email" required />
          </div>
        </div>

        <div class="grid grid-2">
          <div class="form-control">
            <label>Timeline</label>
            <select id="timeline" required>
              <option value="">Choose…</option>
              <option>ASAP</option>
              <option>30-60 days</option>
              <option>60-90 days</option>
              <option>90+ days</option>
              <option>Just exploring</option>
            </select>
          </div>

          <div class="form-control">
            <label>Text updates</label>
            <div class="pill-group" id="textUpdates">
              <button class="pill" data-value="true">Yes</button>
              <button class="pill active" data-value="false">No</button>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button id="cancelLead" type="button" class="ghost">Cancel</button>
          <button type="submit" class="primary">Continue</button>
        </div>

        <div id="statusLead" class="status-line"></div>
      </form>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
